#!/bin/bash
# Establecer variables de localizaci칩n a valores predeterminados
export LC_ALL=C
export LANG=C

# Asegura que el script se detenga si alg칰n comando falla
set -e

# Activar el entorno virtual
source ./backend/venv/bin/activate 

# Ejecutar Black para formatear Python
echo "游游 Running Black for Python files..."
black backend/

# Ejecutar isort para ordenar imports en Python
echo "游游 Running isort for Python files..."
isort backend/  # Se detectar치 autom치ticamente el archivo pyproject.toml

# Ejecutar Ruff para linting Python
echo "游游 Running Ruff for Python files..."
ruff check --fix backend/

# Ejecutar Mypy para verificaci칩n de tipos en Python
echo "游游 Running Mypy for type checking..."
mypy --config-file=mypy.ini backend/

# Ejecutar Prettier para formatear archivos del frontend
echo "游游 Running Prettier for frontend files..."
npx prettier --write frontend/ --log-level silent

# Ejecutar ESLint para verificar problemas en el frontend (opcional)
#echo "游游 Running ESLint for frontend files..."
#npx eslint "frontend/**/*.{ts,js,html,css}"

# Verificar si alg칰n archivo fue modificado por los comandos anteriores
git diff --exit-code > /dev/null

# Si hay cambios, los a침adimos autom치ticamente al commit
if [ $? -ne 0 ]; then
  echo "丘뫡뚸 Some files have been modified! Adding them to the commit..."
  git add -u
  echo "游游 Files have been updated and staged for commit."
  exit 1  # Abortamos el commit para que el usuario pueda realizarlo nuevamente con los cambios
fi

# Si no hubo cambios, dejamos que el commit contin칰e
echo "游游 All checks passed! Ready to commit."
